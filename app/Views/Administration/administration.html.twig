{% extends 'rozlozeni.html.twig' %}

{# Page title #}
{% block title %}
    Administrace
{% endblock title %}

{# Page description #}
{% block description %}Administrace stránky{% endblock description %}

{# Page keywords #}
{% block keywords %}{% endblock keywords %}

{% block content %}
    <div id="administration">
        <h2>Administrace stránky</h2>
        <div class="main-container">
            <div class="division-box">
                <div class="other-buttons">
                    <a class="btn btn-success" href="{{ pageName }}/addDivision" role="button"><i class='bx bx-plus-circle'></i> Přidat nový oddíl</a>
                </div>
                <table class="table table-striped" id="divisionTable">
                    <thead>
                    <tr>
                        <th class="text-center" scope="col">#</th>
                        <th class="text-center" scope="col">Akce</th>
                        <th scope="col">Jméno oddílu</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for division in divisions %}
                        <tr>
                            <th class="text-center align-middle" scope="row">{{ loop.index }}</th>
                            <td class="text-center">
                                <a class="btn btn-danger confirmation"
                                   alertMess="Opravdu chcete odstranit oddíl: {{ division.nameDivision }}?"
                                   alertYes="Ano, odstranit"
                                   alertNo="Zrušit"
                                   href="/{{ pageName }}?action=deleteDivision({{ division.id }})" role="button"><i class='bx bx-trash'></i></a>
                                <a class="btn btn-primary" href="/{{ pageName }}?action=redirectToEdit({{ division.id }})" role="button"><i class='bx bx-pencil'></i></a>
                            </td>
                            <td class="align-middle">{{ division.nameDivision }}</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
            <div class="users-box">
                <div class="other-buttons">
                    <a class="btn btn-success" href="{{ pageName }}/addUser" role="button"><i class='bx bx-plus-circle'></i> Přidat nového uživatele</a>
                </div>
                <table class="table table-striped" id="userTable">
                    <thead>
                    <tr>
                        <th class="text-center" scope="col">#</th>
                        <th class="text-center" scope="col">Akce</th>
                        <th scope="col">Login</th>
                        <th scope="col">Celé jméno</th>
                        <th scope="col">Role</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for user in users %}
                        <tr>
                            <th class="text-center align-middle" scope="row">{{ loop.index }}</th>
                            <td class="text-center">
                                <a class="btn btn-danger confirmation {% if user.id == userID %} disabled {% endif %}" title="Odstranit uživatele"
                                   alertMess="Opravdu chcete odstranit uživatele: {{ user.username }}?"
                                   alertYes="Ano, odstranit"
                                   alertNo="Zrušit"
                                   href="/{{ pageName }}?action=deleteUser({{ user.id }})" role="button"><i class='bx bx-trash'></i></a>
                                <a class="btn btn-primary" title="Upravit uživatele" href="/{{ pageName }}?action=redirectToEdit({{ user.id }})" role="button"><i class='bx bx-pencil'></i></a>
                                {% if user.cashier == 0 %}
                                    <a class="btn btn-secondary" title="Pověřit pokladníkem" href="/{{ pageName }}?action=entrustCashier({{ user.id }})" role="button"><i class='bx bx-badge-check'></i></a>
                                {% else %}
                                    <a class="btn btn-warning" title="Zrušit pověření pokladníka" href="/{{ pageName }}?action=disableCashier({{ user.id }})" role="button"><i class='bx bx-badge-check'></i></a>
                                {% endif %}
                            </td>
                            <td class="align-middle">{{ user.username }}</td>
                            <td class="align-middle">{{ user.name }} {{ user.surname }}</td>
                            <td class="align-middle">{{ user.roleText }}</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>

    </div>
{% endblock content%}

{% block scripts %}
    <script>
        $('.confirmation').on('click', function (e) {
            e.preventDefault();

            var href = $(this).attr('href');
            var alertMess = $(this).attr('alertMess');
            var alertYes = $(this).attr('alertYes');
            var alertNo = $(this).attr('alertNo');

            return bootbox.confirm({
                message: alertMess,
                buttons: {
                    confirm: {
                        label: alertYes,
                        className: 'btn-outline-danger'
                    },
                    cancel: {
                        label: alertNo,
                        className: 'btn-secondary'
                    }
                },
                callback: function (result) {
                    if (result) {
                        window.location = href
                    }
                }
            });
        });

        $(document).ready( function () {
            $('#userTable').DataTable();
            $('#divisionTable').DataTable();
        } );
    </script>
{% endblock scripts%}